workload:
  type: statefulset
  replicas: 1

persistence:
  enabled: true
  storageClass: gp3
  size: 10Gi
  mount:
    defaultEnabled: true
    mountPath: /data

initContainers:
  - name: migrate
    image: alpine:3.20
    command: ["sh", "-c", "echo running migration; sleep 2"]
    securityMode: privileged
    securityContext:
      capabilities:
        add: ["SYS_ADMIN"]
    # inherits default data mount (/data)

containers:
  - name: app
    image: nginx:1.25-alpine
    ports:
      - name: http
        containerPort: 8080
      - name: metrics
        containerPort: 9090
    dataMount:
      enabled: true
      mountPath: /var/lib/app # override global

  - name: worker
    image: busybox
    command: ["sh", "-c", "sleep 3600"]
    dataMount:
      enabled: false # no data mount in this container

# Primary headless for STS, plus extra services
service:
  headless:
    enabled: true
  ports:
    - name: http
      port: 80
      targetPort: http

extraServices:
  - name: metrics
    type: ClusterIP
    ports:
      - name: metrics
        port: 9090
        targetPort: metrics

ingresses:
  - name: public
    enabled: true
    className: nginx
    hosts:
      - host: app.example.com
        paths:
          - path: /
            pathType: Prefix
            service: { name: primary, port: http } # primary, port "http"
          - path: /metrics
            pathType: Prefix
            service: { name: metrics, port: metrics } # extra service
